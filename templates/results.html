{% extends 'base.html' %}
{% block title %}Bot Results{% endblock %}
{% block content %}
<h1 class="mb-4">Trading Bot Results</h1>
<div class="card mb-4">
  <div class="card-body">
    <h4>Consolidated Watchlist & Shortlist</h4>
    <div class="table-responsive mb-4">
      <table class="table table-sm table-bordered" id="consolidated-table">
        <thead>
          <tr>
            <th>Type</th>
            <th>Symbol</th>
            <th>Added/Start</th>
            <th>End/Reason</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
// Fetch and render consolidated table (limit to 10 rows)
Promise.all([
  fetch('/api/watchlist').then(r => r.json()),
  fetch('/api/shortlist').then(r => r.json())
]).then(([watchlist, shortlist]) => {
  const tbody = document.querySelector('#consolidated-table tbody');
  tbody.innerHTML = '';
  watchlist.slice(0, 5).forEach(row => {
    tbody.innerHTML += `<tr><td>Watchlist</td><td>${row.symbol}</td><td>${row.added_on}</td><td>${row.reason}</td></tr>`;
  });
  shortlist.slice(0, 5).forEach(row => {
    tbody.innerHTML += `<tr><td>Shortlist</td><td>${row.symbol}</td><td>${row.consolidation_start}</td><td>${row.consolidation_end}</td></tr>`;
  });
});
</script>
{% endblock %}
